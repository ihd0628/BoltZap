# 비트코인 라이트닝 네트워크: 개발자 가이드

이 가이드는 "Wallet of Satoshi"와 같은 지갑 앱을 만들고자 하는 분들을 위해 비트코인 라이트닝 네트워크(LN)를 심층적으로 설명합니다.

## 1. 라이트닝 네트워크란 무엇인가?

라이트닝 네트워크는 비트코인 위에 구축된 **레이어 2(Layer 2)** 프로토콜입니다. 비트코인이 "정산 레이어"(중앙은행의 금고)라면, 라이트닝은 "거래 레이어"(Visa/Mastercard 네트워크)와 같지만, 완전히 탈중앙화되어 있습니다.

### 주요 차이점 비교 (온체인 vs 라이트닝)

| 기능 | 비트코인 (온체인) | 라이트닝 네트워크 (오프체인) |
| :--- | :--- | :--- |
| **속도** | ~10분 (1 컨펌) | 밀리초 ~ 초 단위 |
| **처리량** | 초당 ~7건 거래 | 초당 수백만 건 거래 가능 |
| **비용** | 변동적 ($1 - $20+) | 무시할 수준 (보통 1 사토시 미만) |
| **프라이버시** | 공개 장부 (모두가 모든 거래 내역 볼 수 있음) | 비공개 (어니언 라우팅) |
| **완결성** | 확률적 (컨펌 필요) | 즉각적 (서명 즉시) |

## 2. 작동 원리 (내부 메커니즘)

라이트닝 네트워크는 **지불 채널(Payment Channels)** 과 **HTLC(Hashed Time-Locked Contracts)** 라는 두 가지 핵심 기술에 의존합니다.

### A. 지불 채널 (파이프)
지불 채널은 두 노드 간의 관계입니다.
1.  **개설 (Opening)**: 앨리스와 밥이 비트코인 메인 블록체인의 공유 멀티시그(Multi-Sig) 주소에 실제 비트코인을 예치합니다. 이것이 *펀딩 트랜잭션(Funding Transaction)* 입니다.
2.  **거래 (Transacting)**: 밥에게 돈을 보내기 위해, 앨리스는 "앨리스가 0.4, 밥이 0.6을 가짐"이라는 새로운 "대차대조표"에 서명하여 밥에게 보냅니다. 이 과정은 오프체인에서 즉시 일어납니다. 그들은 초당 수천 번씩 이 잔액을 업데이트할 수 있습니다.
3.  **폐쇄 (Closing)**: 어느 당사자든 최종 잔액을 비트코인 블록체인에 브로드캐스트하여 자금을 정산할 수 있습니다.

### B. 라우팅 (네트워크)
돈을 보내고 싶은 모든 사람과 직접 채널을 연결할 필요는 없습니다.
*   **앨리스**가 **찰리**에게 돈을 보내고 싶지만, **밥**과만 채널이 연결되어 있다면:
*   앨리스 -> 밥 -> 찰리 순서로 돈을 전달합니다.
*   이는 **HTLC** 덕분에 신뢰가 필요 없습니다(Trustless). 밥은 중간에서 돈을 훔칠 수 없으며, 원자적(atomically)으로 자금을 이동시킵니다. 중간에 연결이 끊기면 모든 자금은 원래 주인에게 돌아갑니다.

## 3. 궁금하셨던 점 답변

### "인터넷에 연결만 되어 있으면 누구나 접근 가능한가요?"
**네, 그렇습니다.** 라이트닝 네트워크는:
*   **허가 불필요 (Permissionless)**: 누구도 당신이 노드를 운영하거나 채널을 여는 것을 막을 수 없습니다.
*   **P2P**: TCP/IP (및 Tor) 위에서 작동합니다. 다른 노드와 통신하기 위해 인터넷 연결만 있으면 됩니다.

### "누구나 트랜잭션을 발생시킬 수 있나요?"
네, 다음 조건만 갖춘다면 가능합니다:
1.  **유동성 (Liquidity)**: 지출할 자금이 채널에 있어야 합니다.
2.  **연결성 (Connectivity)**: 암호화된 업데이트에 서명하기 위해 온라인 상태여야 합니다.

## 4. "Wallet of Satoshi" 클론 만들기

"Wallet of Satoshi"는 **수탁형(Custodial) 지갑**입니다.
*   **수탁형 (Custodial)**: UX가 가장 간단합니다. 회사가 노드를 운영하고, 사용자는 (Gmail처럼) 계정만 갖습니다.
*   **비수탁형 (Non-Custodial)**: 사용자가 (폰에서) 직접 노드를 운영합니다. 이것이 "진짜" 비트코인 소유 방식입니다.

**2025년 기준, 현대적인 고품질 지갑을 만들기 위한 기술 스택은 다음과 같습니다:**

### 옵션 A: "Breez SDK" 또는 "Greenlight" 사용 (MVP 추천)
*   **작동 방식**: 앱 내에 아주 작은 노드를 내장합니다. 복잡한 작업(클라우드 백업, 경로 찾기 등)은 LSP(유동성 서비스 제공자)가 처리합니다.
*   **장점**: 개발이 매우 쉽습니다. 사용자는 "진짜" 비수탁형 비트코인을 경험합니다.
*   **도구**:
    *   **Breez SDK**: 모든 것(연결, 동기화, LSP)을 처리합니다.
    *   **Greenlight (Blockstream)**: 키는 사용자 폰에, 노드는 클라우드에서 돌아가는 하이브리드 방식입니다.

### 옵션 B: "LDK (Lightning Dev Kit)" 사용 (완전한 제어)
*   **작동 방식**: Rust/Swift/Kotlin 컴포넌트를 사용하여 바닥부터 커스텀 노드를 구현합니다. Cash App이나 Bitkey가 이 방식을 사용합니다.
*   **장점**: 모든 것을 제어할 수 있으며 특정 서비스 제공자에 의존하지 않습니다.
*   **단점**: 구현 난이도가 훨씬 높습니다.

## 5. 학습 로드맵

1.  **개념 숙지**: "마스터링 비트코인/라이트닝 네트워크" (Andreas Antonopoulos) 등의 자료 읽기.
2.  **노드 돌려보기**: PC에 **LND**나 **Core Lightning**을 설치해서 CLI 명령어로 직접 채널을 열고 닫아보며 감을 익히세요.
3.  **Hello World**: **Breez SDK**를 사용하여 테스트넷(Testnet)에서 1 사토시를 받을 수 있는 간단한 앱을 만들어보세요.

## 6. 개발자 용어 사전
*   **Bolt 11**: QR코드 인보이스 표준입니다.
*   **Bolt 12**: 고정 QR코드(이메일 주소처럼 재사용 가능)를 허용하는 새로운 표준입니다.
*   **LSP (Liquidity Service Provider)**: 사용자가 즉시 돈을 받을 수 있도록 자동으로 채널을 열어주는 서비스입니다.
*   **인바운드 유동성 (Inbound Liquidity)**: 돈을 *받을 수 있는* 용량 (빈 컵의 공간).
*   **아웃바운드 유동성 (Outbound Liquidity)**: 돈을 *보낼 수 있는* 용량 (컵에 들어있는 물).
